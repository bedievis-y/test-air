<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/popup-basket.css">
    <link rel="stylesheet" href="style/shop-style.css">
    <link rel="icon" href="images/icon.svg">
    <title>Airtechnic</title>
    <style>
        .cart-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1fadff;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
            font-family: 'Geologica';
        }

        .cart-notification.fade-out {
            opacity: 0;
        }
    </style>

</head>

<body>
    <header class="header-products no-scroll-animation">
        <div class="container header__container-position">
            <div class="header__content">
                <a href="index.html" class="logo">
                    <img src="images/head_logo.png" alt="">
                </a>
                <button class="burger-menu">
                    <span></span>
                    <span></span>
                </button>

                <div class="header__sizedBox-expnad">

                </div>

                <ul class="list no-scroll-animation">
                    <a href="about.html" class="link">
                        <li>о компании</li>
                    </a>
                    <a href="partners.html" class="link">
                        <li>партнеры</li>
                    </a>
                    <a href="service.html" class="link">
                        <li>сервисы</li>
                    </a>
                    <a href="products.html" class="link-products">
                        <li>продукты</li>
                    </a>
                    <a href="contacts.html" class="link">
                        <li>контакты</li>
                    </a>
                    <a target="_blank" href="https://t.me/AirTechnic_Irina" class="link_hover">
                        <li>Cвязаться с нами</li>
                    </a>
                </ul>
                <div class="lang-dropdown">
                    <div class="globe">
                        <img src="images/globe.svg" alt="">
                        <div class="arrow"></div>
                    </div>
                    <div class="dropdown-content">
                        <a href="#" data-lang="ru">RU</a>
                        <a href="#" data-lang="en">ENG</a>
                    </div>
                </div>
            </div>
            <h1 class="service-title">
                Продукты
            </h1>

        </div>
    </header>

    <div class="main">
        <div class="container shop">
            <aside class="shop__sidebar">
                <h2 class="shop__title">Категория</h2>
                <ul class="shop__category-list" id="category-list"></ul>
            </aside>

            <section class="shop__content" id="product-list"></section>
        </div>

        <section class="blue__foot">
            <div class="container">
                <div class="blue__foot-content">
                    <div class="blue__foot-left">
                        <h3 class="blue__title">
                            Присоединяйтесь к числу наших довольных клиентов
                        </h3>
                        <div class="blue__text">
                            Получите высококачественное обслуживание и надежный ремонт
                            компрессоров от ООО «AirTechnic»
                        </div>
                    </div>
                    <div class="blue__foot-right">
                        <div class="blue__foot-link">
                            <a href="">
                                Написать нам
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="container">
            <div class="contact-section">
                <div class="contact-info">
                    <h2 class="contact-header">Свяжитесь с нами</h2>
                    <p class="contact-description">
                        Мы всегда готовы помочь вам с любыми вопросами и предложениями. Если у вас есть вопросы по нашим
                        услугам или вам требуется техническая поддержка, свяжитесь с нами удобным для вас способом.
                    </p>
                    <div class="contact-details">
                        <div class="contact-item">
                            <img src="images/mail.svg" alt="Email" class="contact-icon">
                            <div class="contact-text">
                                <strong>Email</strong><br>
                                sales@airtechnic.uz
                            </div>
                        </div>
                        <div class="contact-item">
                            <img src="images/location.svg" alt="Офис" class="contact-icon">
                            <div class="contact-text">
                                <strong>Офис</strong><br>
                                100174 Уста Ширин ул. 116, Ташкент, Узбекистан
                            </div>
                        </div>
                        <div class="contact-item">
                            <img src="images/call.svg" alt="Главный инженер" class="contact-icon">
                            <div class="contact-text">
                                <strong>Главный Инженер</strong><br>
                                +99893-516 28 85 | +99898-821 28 85
                            </div>
                        </div>
                    </div>
                </div>
                <div class="contact-form-section">
                    <h3 class="form-header">Оставьте ваши контакты</h3>
                    <form action="#" method="post" class="contact-form">
                        <input type="text" name="name" placeholder="Ваше имя" class="form-input">
                        <input type="email" name="email" placeholder="Ваш телефон" class="form-input">
                        <textarea name="comment" placeholder="Комментарий..." class="form-textarea"></textarea>
                        <button type="submit" class="form-button">Отправить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-logo">
            <img src="images/footer__lolog.png" alt="logo">
        </div>
        <ul class="footer-list">
            <a href="" class="footer-link">
                <li>главная</li>
            </a>
            <a href="" class="footer-link">
                <li>о нас</li>
            </a>
            <a href="" class="footer-link">
                <li>сервисы</li>
            </a>
            <a href="" class="footer-link">
                <li>контакты</li>
            </a>
        </ul>
        <div class="socials">
            <div class="social">
                <a target="_blank" href="https://www.facebook.com/airtechnic.uz/">
                    <img src="images/fb.svg" alt="">
                </a>
            </div>
            <div class="social">
                <a target="_blank" href="https://t.me/AirTechnic_uz">
                    <img src="images/tg.svg" alt="">
                </a>
            </div>
            <div class="social">
                <a target="_blank" href="">
                    <img src="images/ig.svg" alt="">
                </a>
            </div>
            <div class="social">
                <a target="_blank" href="https://www.linkedin.com/company/airtechnic-llc/">
                    <img src="images/ln.svg" alt="">
                </a>
            </div>
        </div>
    </div>

    <div class="popup" id="popup">
        <div class="popup__content">
            <button class="popup__close" id="closePopup">&times;</button>
            <h2 class="popup__title">Ваша корзина</h2>

            <div class="popup__cart">
                <div class="popup__items-container">
                    <table class="popup__table">
                        <thead>
                            <tr>
                                <th class="th--no-scroll">Продукты</th>
                                <th>Название</th>
                                <th>Количество</th>
                                <th>Цена</th>
                                <th>Удалить</th>
                            </tr>
                        </thead>
                        <tbody id="cartItems">
                        </tbody>
                    </table>
                </div>

                <div class="popup__summary">
                    <h3>Общая сумма</h3>
                    <p>Продуктов <span id="totalProducts">0</span></p>
                    <div class="popup__total-box">
                        <span>Общая сумма</span>
                        <span id="totalPrice">0€</span>
                    </div>
                    <button class="popup__checkout">Отправить заявку</button>
                </div>
            </div>
        </div>
    </div>

    <button class="cart-button" id="cartButton">
        <img src="images/shopping-card.svg" alt="Корзина" class="cart-icon">
        <span class="cart-count" id="cartCount">0</span>
    </button>

    <div id="popupOverlay" class="popup-overlay"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAduoxdb-_11TiUDZWeeb5UgKNP3kWMa8",
            authDomain: "airtechnic-295b5.firebaseapp.com",
            projectId: "airtechnic-295b5",
            storageBucket: "airtechnic-295b5.firebasestorage.app",
            messagingSenderId: "389679362580",
            appId: "1:389679362580:web:e4474e8e171b04d5e4ad01"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadCategories() {
            const categoriesContainer = document.querySelector("#category-list");
            categoriesContainer.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "products"));
            const categories = new Set();

            querySnapshot.forEach((doc) => {
                categories.add(doc.data().category);
            });

            const allCategoryItem = document.createElement("li");
            allCategoryItem.className = "shop__category-item active";
            allCategoryItem.textContent = "Все товары";

            allCategoryItem.addEventListener("click", () => {
                setActiveCategory(allCategoryItem);
                loadProducts();
            });

            categoriesContainer.appendChild(allCategoryItem);

            categories.forEach((category) => {
                const categoryItem = document.createElement("li");
                categoryItem.className = "shop__category-item";
                categoryItem.textContent = category;

                categoryItem.addEventListener("click", () => {
                    setActiveCategory(categoryItem);
                    loadProducts(category);
                });

                categoriesContainer.appendChild(categoryItem);
            });

            loadProducts();
        }

        function setActiveCategory(selectedItem) {
            document.querySelectorAll(".shop__category-item").forEach((el) => {
                el.classList.remove("active");
            });
            selectedItem.classList.add("active");
        }


        async function loadProducts(selectedCategory = null) {
            const productsContainer = document.querySelector("#product-list");
            productsContainer.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "products"));

            querySnapshot.forEach((doc) => {
                const product = doc.data();

                if (selectedCategory && product.category !== selectedCategory) return;

                const productCard = document.createElement("div");
                productCard.className = "shop__product-card";
                productCard.innerHTML = `
            <div class="shop__product-img-wrapper">
                <img class="shop__product-img" src="${product.imageUrl}" alt="${product.name}">
            </div>
            <span class="shop__product-category">${product.category}</span>
            <h3 class="shop__product-title">${product.name}</h3>
            <p class="shop__product-price">${product.price} сум</p>
            <button class="shop__product-button">Добавить в корзину</button>
        `;

                productsContainer.appendChild(productCard);
            });
        }

        document.addEventListener("DOMContentLoaded", async () => {
            await loadCategories();

            const cartButton = document.getElementById("cartButton");
            const cartCount = document.getElementById("cartCount");

            function updateCartCount() {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                let totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalCount;
                cartCount.style.display = totalCount > 0 ? "flex" : "none";
            }

            document.addEventListener("click", function (event) {
                if (event.target && event.target.classList.contains("shop__product-button")) {
                    const productCard = event.target.closest(".shop__product-card");

                    const product = {
                        name: productCard.querySelector(".shop__product-title").textContent,
                        price: productCard.querySelector(".shop__product-price").textContent.replace(" сум", "").trim(),
                        imageUrl: productCard.querySelector(".shop__product-img").src,
                        category: productCard.querySelector(".shop__product-category").textContent,
                        quantity: 1,
                    };

                    addToCart(product);
                }
            });

            function addToCart(product) {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                const existingProduct = cart.find(item => item.name === product.name);

                if (existingProduct) {
                    existingProduct.quantity += 1;
                } else {
                    cart.push(product);
                }

                localStorage.setItem("cart", JSON.stringify(cart));
                updateCartCount();
                showNotification("Товар добавлен в корзину!");
            }

            // Функция уведомления
            function showNotification(message) {
                const notification = document.createElement("div");
                notification.className = "cart-notification";
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.classList.add("fade-out");
                    setTimeout(() => notification.remove(), 500);
                }, 2000);
            }

            updateCartCount();

        });
    </script>

    <script src="js/popup-basket.js"></script>
    <script src="js/script.js"></script>
</body>

</html>